<html>
<head>
<script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1" ></script>
<script src="/js-client/player.js" ></script>
<script>

/* global DigitalFrontierAS */
var player = new DigitalFrontierAS.Player();

var compositions = ["music/J60_R606_HNRG_WIP.json", "music/KOMP_WIP.json", "music/J60BITALL.json", "music/J60BITALL_STATISK_PROB.json", "music/J60_BPM.json"];

player.onEnded = function () {
	var image = document.getElementById("image");
    image.src = "playCROP.png";
	image.style.display = "block";
	playing = false;
	var video = document.getElementById("video");
	video.pause();
};

player.onPlaying = function () {
	var image = document.getElementById("image");
	var video = document.getElementById("video");
	video.play();
	image.style.display = "none";
}

function playSong() {
	player.play();
}

function pauseSong() {
	player.pause();
}

function resumeSong() {
	player.resume();
}

function stopSong() {
	player.stop();
}

function init() {
	try {
		var request = new XMLHttpRequest();
		request.open('GET', "music/Side A.json", true);
		request.onload = function () {
			var song = JSON.parse(request.responseText);
			player.load(song, "music/");
			var image = document.getElementById("image");
			image.src = "playCROP.png";
			image.style.display = "block";
		}
		request.send();
	}
	catch (e) {}
}

var playing = false;

function randomElement(array) {
    if (!array) return null;
    if (array.length === 0) return null;
    var index = Math.floor(Math.random() * array.length);
    return array[index];
}


function imageClicked() {
	var image = document.getElementById("image");
	var video = document.getElementById("video");
	if (playing) {
		player.stop();
		image.src = "playCROP.png";
		image.style.display = "block";
		playing = false;
		video.pause();
	} else {
        var songUrl = randomElement(compositions);
        try {
            var request = new XMLHttpRequest();
            request.open('GET', songUrl, true);
            request.onload = function () {
                var song = JSON.parse(request.responseText);
                player.load(song, "music/");
                var image = document.getElementById("image");
                image.src = "loading.gif";
				image.style.display = "block";
                player.play();
                playing = true;
                video.currentTime = 0.0;
            }
            request.send();
        }
        catch (e) {}

	}
}

</script>

<style>
	.fullscreen {
		position: fixed;
		width: 100%;
		height: 100%;
		left: 0;
		top: 0;
	}
	#video {
		z-index: 10;
		background-color: #cfacd6;
	}
	#image {
		display: block;
		margin-left: auto;
		margin-right: auto;	
		width: 400px;
		height: 400px;
		text-align: center;
    /*
		vertical-align: middle;
		display: table-cell;
		text-align: center;
		*/
	}
	#imagediv {
		background: rgba(255,255,255,0.0);
		border: 1px solid black;
		z-index: 20;
	}
</style>

</head>


<body valign="top">
	<div id="imagediv" class="fullscreen" onclick="imageClicked()"><img src="playCROP.png" id="image"/></div>
	<video id="video" class="fullscreen" loop="true">
		<source src="music/video.mp4" type="video/mp4">
	</video>
</body>
</html>
